import{r as n,j as e}from"./index-yh7jtPQN.js";import{B as F}from"./index-C-kGUL9P.js";import{f as Y,g as H,h as U}from"./index-CzIASJHn.js";import{M as W}from"./index-DLkXPCR4.js";import{a as l}from"./index-B9ygI19o.js";import"./iconBase-B40uof1y.js";const G="_chatbox_1iqiq_25",J="_header_1iqiq_33",K="_input_1iqiq_51",Q="_ticketItem_1iqiq_117",V="_avatar_1iqiq_131",X="_active_1iqiq_145",Z="_detail_1iqiq_177",ee="_assignDropdown_1iqiq_195",se="_statusDropDown_1iqiq_197",te="_icon_1iqiq_229",ae="_messagesContainer_1iqiq_253",ie="_messageRow_1iqiq_273",ne="_mine_1iqiq_283",oe="_theirs_1iqiq_291",ce="_messageBubble_1iqiq_299",le="_messageText_1iqiq_355",re="_messageTime_1iqiq_363",de="_popupOverlay_1iqiq_381",he="_popupBox_1iqiq_407",me="_popupButtons_1iqiq_423",t={"contactcenter-container":"_contactcenter-container_1iqiq_1","chats-container":"_chats-container_1iqiq_11",chatbox:G,header:J,input:K,"ticket-assign":"_ticket-assign_1iqiq_103",ticketItem:Q,avatar:V,active:X,"active-ticketDetails":"_active-ticketDetails_1iqiq_155",detail:Z,assignDropdown:ee,statusDropDown:se,icon:te,messagesContainer:ae,messageRow:ie,mine:ne,theirs:oe,messageBubble:ce,"chat-disabled":"_chat-disabled_1iqiq_337",messageText:le,messageTime:re,popupOverlay:de,popupBox:he,popupButtons:me},ke=()=>{const[d,g]=n.useState([]),[a,h]=n.useState(null),[C,u]=n.useState(!1),[A,x]=n.useState(!1),[q,k]=n.useState(null),[B,N]=n.useState(null),[D,f]=n.useState([]),[m,S]=n.useState(""),[pe,ge]=n.useState(!1),[I,M]=n.useState([]),_=sessionStorage.getItem("role"),$=sessionStorage.getItem("userId"),j=a?.status==="resolved",T=_==="admin"&&String(a?.assignedTo?._id)!==String($),O=j||T,z=async()=>{const s=sessionStorage.getItem("token");await l.get("http://localhost:5000/api/ticket/",{headers:{Authorization:`Bearer ${s}`}}).then(i=>{console.log(i.data,"ticketsabbe"),g(i.data.tickets)}).catch(i=>{console.log(i)})},R=async()=>{const s=sessionStorage.getItem("token");await l.get("http://localhost:5000/api/team",{headers:{Authorization:`Bearer ${s}`}}).then(i=>{const o=i.data.teamMembers;M(o)})},E=async s=>{const i=sessionStorage.getItem("token");if(s)try{await l.put(`http://localhost:5000/api/ticket/assign/${a._id}`,{assignedTo:s},{headers:{Authorization:`Bearer ${i}`}}).then(o=>{const c=o.data.assignedTo,r={...a,assignedTo:c};h(r),g(p=>p.map(w=>w._id===r._id?r:w))})}catch(o){console.error("Assign error:",o)}},P=async s=>{const i=sessionStorage.getItem("token");await l.patch(`http://localhost:5000/api/ticket/${a._id}/status`,{status:s},{headers:{Authorization:`Bearer ${i}`}}).then(o=>{const c={...a,status:s};h(c),g(r=>r.map(p=>p._id===a._id?c:p))})},b=async s=>{const i=sessionStorage.getItem("token");await l.get(`http://localhost:5000/api/message/${s}`,{headers:{Authorization:`Bearer ${i}`}}).then(o=>{const c=o.data.messages;console.log(o.data.messages,"message"),f(c)})},L=async()=>{if(!m.trim())return;const s=sessionStorage.getItem("token");try{await l.post(`http://localhost:5000/api/message/team/${a._id}`,{text:m},{headers:{Authorization:`Bearer ${s}`}}).then(i=>{console.log(i),f(o=>[...o,i.data.message]),b(a._id),S("")})}catch(i){console.log("Send Message Error:",i)}},v=["/avatar1.jpg","/avatar2.jpg","/avatar3.jpg","/avatar4.jpg"],y=s=>{if(!s)return v[0];const i=s.charCodeAt(0)%v.length;return v[i]};return n.useEffect(()=>{z(),_==="admin"&&R()},[]),n.useEffect(()=>{a?._id&&b(a._id)},[a]),n.useEffect(()=>{d.length>0&&!a&&h(d[0])},[d]),e.jsxs("div",{className:t["contactcenter-container"],children:[e.jsxs("div",{className:t["chats-container"],children:[e.jsx("span",{children:"Chats"}),e.jsx("div",{className:t.ticketList,children:d.map(s=>{const i=s.messages?.[s.messages.length-1];return e.jsxs("div",{className:`${t.ticketItem} ${a?._id===s._id?t.active:""}`,onClick:()=>{h(s)},children:[e.jsx("img",{src:y(s.name),alt:s.name,className:t.avatar}),e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[e.jsx("div",{style:{color:"#3A7ABD",fontWeight:"500",fontSize:"1rem"},children:s.name}),e.jsx("div",{className:t.ticketLastMessage,children:i?i.text:"No messages yet"})]})]},s._id)})})]}),e.jsxs("div",{className:t.chatbox,children:[e.jsxs("div",{className:t.header,children:[e.jsxs("span",{children:[" ",a&&e.jsx(e.Fragment,{children:e.jsx("p",{children:a.ticketId})})]}),e.jsx("span",{className:t.icon,children:e.jsx(Y,{})})]}),j&&e.jsx("p",{className:t["chat-disabled"],children:"This chat has been resolved"}),T&&!j&&e.jsx("p",{className:t["chat-disabled"],children:"This chat is assigned to another team member. You no longer have access."}),e.jsx("div",{className:t.messagesContainer,children:D.map(s=>{const i=s.sender==="team";return e.jsxs("div",{className:`${t.messageRow} ${i?t.mine:t.theirs}`,children:[e.jsxs("div",{className:t.messageBubble,children:[e.jsx("p",{className:t.messageText,children:s.text}),e.jsx("span",{className:t.messageTime,children:s.createdAt?new Date(s.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""})]}),s.sender!=="team"&&e.jsx("div",{style:{color:"Red",fontSize:".8rem",display:"flex",alignItems:"flex-end",paddingLeft:"1rem"},children:s.missed?"missed chat":""})]},s._id)})}),e.jsxs("div",{className:t.input,children:[e.jsx("input",{onChange:s=>{S(s.target.value)},value:m,placeholder:"Type Here",disabled:O}),e.jsxs("button",{className:t.icon,style:{fontSize:"2rem",display:"flex",alignItems:"center",justifyContent:"center"},onClick:L,disabled:!m.length,children:[" ",e.jsx(F,{})]})]})]}),e.jsxs("div",{className:t["ticket-assign"],children:[e.jsx("div",{children:a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex",style:{alignItems:"center",gap:"10px",marginBottom:"1.2rem"},children:[" ",e.jsx("img",{src:y(a.name),alt:a.name,className:t.avatar}),e.jsx("p",{children:a.name})]}),e.jsx("p",{children:"Details"}),e.jsxs("p",{className:t["active-ticketDetails"],children:[e.jsxs("span",{className:t.icon,children:[" ",e.jsx(W,{})]}),e.jsx("span",{className:t.detail,children:a.name})]}),e.jsxs("p",{className:t["active-ticketDetails"],children:[" ",e.jsxs("span",{className:t.icon,children:[" ",e.jsx(H,{})]}),e.jsx("span",{className:t.detail,children:a.phone})]}),e.jsxs("p",{className:t["active-ticketDetails"],children:[" ",e.jsxs("span",{className:t.icon,children:[" ",e.jsx(U,{})]}),e.jsx("span",{className:t.detail,children:a.email})]})]})}),e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsx("p",{children:"Teammates"}),e.jsxs("div",{children:[" ",a&&_==="admin"&&e.jsxs("select",{value:a.assignedTo?._id||"",onChange:s=>{N(s.target.value),u(!0)},className:t.assignDropdown,children:[e.jsx("option",{value:"",children:"Select Member"}),I.map(s=>e.jsx("option",{value:s._id,children:s.name},s._id))]})]})]}),C&&e.jsx("div",{className:t.popupOverlay,children:e.jsxs("div",{className:t.popupBox,children:[e.jsx("h3",{children:"Assign Ticket?"}),e.jsx("p",{children:"Do you want to assign this ticket to selected team member?"}),e.jsxs("div",{className:t.popupButtons,children:[e.jsx("button",{onClick:()=>{E(B),u(!1)},children:"Yes, Assign"}),e.jsx("button",{onClick:()=>{N(null),u(!1)},children:"Cancel"})]})]})}),e.jsx("div",{children:a&&e.jsxs("select",{value:a.status,onChange:s=>{k(s.target.value),x(!0)},className:t.statusDropDown,children:[e.jsx("option",{value:"unresolved",children:"Unresolved"}),e.jsx("option",{value:"resolved",children:"Resolved"})]})}),A&&e.jsx("div",{className:t.popupOverlay,children:e.jsxs("div",{className:t.popupBox,children:[e.jsx("h3",{children:"Change Status?"}),e.jsxs("p",{children:["Are you sure you want to mark this ticket as"," ",e.jsx("strong",{children:q}),"?"]}),e.jsxs("div",{className:t.popupButtons,children:[e.jsx("button",{onClick:()=>{P(q),x(!1)},children:"Yes, Change"}),e.jsx("button",{onClick:()=>{k(null),x(!1)},children:"Cancel"})]})]})})]})]})};export{ke as default};
